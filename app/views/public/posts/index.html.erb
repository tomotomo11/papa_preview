<div class="container">
  <div class="row">
    <div class="col-md-2">
      <div class="container mt-5">
        <div class="row">
          <table class="table table-bordered mt-5">
            <thead>
              <tr>
                <th style="background-color: #e9ecef; border-color: #dee2e6;">商品カテゴリ</th>
              </tr>
            </thead>
            <tbody>
              <% @genres.each do |genre| %>
                <tr>
                  <% if genre.is_active == true %>
                    <td>
                      <%= link_to genre.name, posts_path(genre_id: genre.id) %>
                    </td>
                  <% end %>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-10">
      <h1 class="mb-4 mt-3">みんなの投稿</h1>
      <% if user_signed_in? %>
        <div class="col-md-5 my-3 p-3 border shadow-sm">
          <div class="tag-search">
            <%= form_with url: posts_path, local: true, method: :get do |f| %>
              <div class="d-flex flex-row flex-wrap">
                <%= f.collection_check_boxes :tag_ids, Tag.all, :id, :name, { include_hidden: false } do |b| %>
            	    <div class="mx-1">
            	      <%= b.check_box %>
            	      <%= b.label %>
            	    </div>
                <% end %>
                <%= button_tag type: "submit", class: "border rounded-pill shadow-sm search-btn" do %>
      	    <i class="fas fa-search"></i>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="row d-flex flex-wrap">
        <% @posts.each do |post| %>
          <div class="col-md-4 mb-3 pt-1 px-1">
            <div class="card">
              <%= link_to post_path(post.id) do %>
                <%= image_tag post.get_image(350, 250), class: "card-img-top card-link" %>
              <% end %>
              <div class="card-body">
                <h5 class="card-title"><span class="yellow-bg">商品名: <%= post.name %></span></h5>
                <div>
                  <%= render "static_rate", post: post %>
                </div>
              <div class="d-flex align-items-center mt-1">
                <p>
                  <% if post.favorited_by?(current_user) %>
                    <p>
                      <%= link_to post_favorite_path(post), method: :delete do %>
                        ♥：<%= post.favorites.count %>
                      <% end %>
                    </p>
                    <% else %>
                    <p>
                      <%= link_to post_favorite_path(post), method: :post do %>
                        ♥：<%= post.favorites.count %>
                      <% end %>
                    </p>
                  <% end %>
                </p>
                <p class="ml-3">コメント件数：<%= link_to "#{post.post_comments.count}", post_path(post.id) %></p>
                </div>
                <p>一言: <%= post.title %></p>
                <p>ジャンル: <%= post.genre.name %></p>
                <p>投稿者: <%= post.user.full_name %></p>
                <div class="text-right"><%= link_to "詳細へ", post_path(post.id), class: "btn btn-sm btn-primary" %></div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center">
    <%= paginate @posts %>
  </div>
</div>
